# Linux运维——系统管理

[TOC]

## 一、进程管理

### 1、进程简介

#### 1.1、什么是进程管理

进程是正在执行的一个程序或命令，每一个进程都是一个运行的实体。都有自己的地址空间，并占用一定的系统资源。

#### 1.2、进程管理的作用

- 判断服务器健康装填。
- 查看系统中所有的进程
- 杀死进程

### 2、进程的查看

#### 2.1PS命令

用来静态显示系统中进程的命令。

- 查看系统中的所有进程，使用BSD操作系统格式

```
ps aux
```

- 查看系统中所有进程，使用Linux标准命令格式

```
ps -le
```

- 常用选项

```
a	显示一个终端所有进程，处理绘画引线
u	显示进程的归属用户及内存的使用情况
x	显示没有控制终端的进程
```

- ps aux命令输出项
  - USER：该进程是由那个用户产生的
  - PID：进程的ID号
  - %CPU：该进程占用的cpu资源的百分比
  - %MEM：该进程占用的物理内存的百分比
  - VSZ：该进程占用虚拟内存的大小，单位kb
  - RSS：该进程占用实际物理内存的大小，单位kb
  - TTY：该进程是在那个终端中运行。
    - 其中tty1-7代表本地控制台终端（可以通过alt+F1-F7键切换不同的终端）tty1-6是本地字符界面终端，tty7是图形终端。
    - pts/0-255代表虚拟终端，一般是远程连接的终端，第一个远程连接占用的是pts/0终端，依次增长。
  - STAT：进程状态
    - D：不可被唤醒的睡眠状态，通常用于I/O情况
    - R：该进程正在运行
    - S：该进程正在睡眠状态，可以被唤醒
    - T：停止状态，可能是在后台暂停或进程在除错状态
    - Z：僵尸进程。进程已经终止，但是部分程序还在内存当中
    - <：高优先级
    - N：低优先级
    - L：被锁入内存
    - s：包含子进程
    - l：多线程
    - +：位于后台
  - START：该进程的启动时间
  - TIME：该进程占用CPU的运算时间
  - COMMAND：产生此进程的命令名

#### 2.2TOP命令

- 命令格式

```
top [选项]
```

- 选项

```
-d [秒数]：指定top命令每个几秒更新。
-b：使用批处理模式输出。一般和“-n”选项合用，用于把top命令重定向到文件名
-n [次数]：指定top命令执行的次数。
-p：指定PID。只查看某个PID的进程
-s：使top在安全模式运行，避免在交互模式中出现错误
-u [用户名]：只监听某个用户的进程
```

- 交互模式选项

```
?或h：显示交互模式的帮助
P：以CPU使用率排序，默认就是此项
M：以内存的使用率排序
N：以PID排序
T：按照CPU的积累运算时间排序，即TIME项排序
```

**统计信息区：**

前五行是当前系统情况整体的统计信息区。下面我们看每一行信息的具体意义。

- 第一行：任务队列信息，同 uptime 命令的执行结果
  - 14:06:23：当前系统时间
  - up 1 days, 12:44：系统已运行时间
  - 2 users：已登录用户数
  - load average: 1.15, 1.42, 1.44：分别为1分钟、5分钟、15分钟的负载情况。

- 第二行：Tasks — 任务（进程）
  - Tasks:95total：系统中的进程总数
  - running：运行进程数
  - sleep：休眠进程数
  - stoped：停止进程数
  - zombie：僵尸状态进程数

- 第三行：cpu状态信息

  - 5.9%us：用户空间占用CPU的百分比。

  - 3.4% sy：内核空间占用CPU的百分比。

  - 0.0% ni：改变过优先级的进程占用CPU的百分比

  - 90.4% id：空闲CPU百分比

  - 0.0% wa：IO等待占用CPU的百分比

  - 0.0% hi：硬中断（Hardware IRQ）占用CPU的百分比

  - 0.2% si：软中断（Software Interrupts）占用CPU的百分比

- 第四行：内存状态

  - 32949016k total：物理内存总量

  - 14411180k used：使用中的内存总量

  - 18537836k free：空闲内存总量

  - 169884k buffers：缓存的内存量

- 第五行：swap交换分区信息

  - 32764556k total：交换区总量

  - 0k used：使用的交换区总量

  - 32764556k free：空闲交换区总量

  - 3612636k cached：缓冲的交换区总量

- 七行以下：各进程（任务）的状态监控

  - PID：进程id
  - USER：进程所有者
  - PR：进程优先级
  - NI：nice值。负值表示高优先级，正值表示低优先级
  - VIRT：进程使用的虚拟内存总量，单位kb。
  - RES：进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA
  - SHR：共享内存大小，单位kb
  - S：进程状态
    - D=不可中断的睡眠状态 
    - R=运行 
    - S=睡眠 
    - T=跟踪/停止 
    - Z=僵尸进程
  - %CPU：上次更新到现在的CPU时间占用百分比
  - %MEM：进程使用的物理内存百分比
  - TIME+：进程使用的CPU时间总计，单位1/100秒
  - COMMAND：进程名称（命令名/命令行）

#### 2.3pstree命令

- 格式

```
pstree [选项]
```

- 选项

```
-p：显示进程的PID
-u：显示进程的所属用户
```

### 3、进程管理

- 系统中可以识别的型号较多，可以使用命令`kill -l`或`man 7 signal`来查询。

```
 1) SIGHUP	 2) SIGINT	 3) SIGQUIT	 4) SIGILL	 5) SIGTRAP
 6) SIGABRT	 7) SIGBUS	 8) SIGFPE	 9) SIGKILL	10) SIGUSR1
11) SIGSEGV	12) SIGUSR2	13) SIGPIPE	14) SIGALRM	15) SIGTERM
16) SIGSTKFLT	17) SIGCHLD	18) SIGCONT	19) SIGSTOP	20) SIGTSTP
21) SIGTTIN	22) SIGTTOU	23) SIGURG	24) SIGXCPU	25) SIGXFSZ
26) SIGVTALRM	27) SIGPROF	28) SIGWINCH	29) SIGIO	30) SIGPWR
31) SIGSYS	34) SIGRTMIN	35) SIGRTMIN+1	36) SIGRTMIN+2	37) SIGRTMIN+3
38) SIGRTMIN+4	39) SIGRTMIN+5	40) SIGRTMIN+6	41) SIGRTMIN+7	42) SIGRTMIN+8
43) SIGRTMIN+9	44) SIGRTMIN+10	45) SIGRTMIN+11	46) SIGRTMIN+12	47) SIGRTMIN+13
48) SIGRTMIN+14	49) SIGRTMIN+15	50) SIGRTMAX-14	51) SIGRTMAX-13	52) SIGRTMAX-12
53) SIGRTMAX-11	54) SIGRTMAX-10	55) SIGRTMAX-9	56) SIGRTMAX-8	57) SIGRTMAX-7
58) SIGRTMAX-6	59) SIGRTMAX-5	60) SIGRTMAX-4	61) SIGRTMAX-3	62) SIGRTMAX-2
63) SIGRTMAX-1	64) SIGRTMAX	
```

- 常用信号

```
1)SIGHUP 重启
9)SIGKILL 强制终止
```

#### 3.1KILL命令

- 格式

```
kill [信号] PID
```

#### 3.2killall命令

使用进程名结束进程，通常用于杀死一类进程

- 格式

```
killall [选项] [信号] 进程名
```

- 选项

```
-i：交互式，询问是否要杀死某个进程
-I：忽略进程名的大小写
```

#### 3.3pkill命令

pkill命令和killall命令赔偿类似，也是按照进程名来杀死进程。

- 语法

```
pkill [选项] [信号] 进程名
选项：
-t [终端号]：按照终端号踢出用户
```

## 二、工作管理

### 1、工作管理简介

- 前台是指当前可以操控和执行命令的操作环境，后台是指工作可以自行运行，但是不能使用ctrl+c来终止，只能使用fg/bg来调用工作
- 当前的登录终端，只能管理当前终端的工作，不能管理其他登录终端的工作。
- 后台的命令可以持续运行一段时间，这样我们才能捕捉和操作这个工作。
- 放入后台的命令不能和前台用户有交互或需要前台输入，否则放入后台只能暂停，不能执行。

### 2、如何将命令放入后台

#### 2.1使用“命令 &”

在命令后加“空格&”，将命令放入后台执行。

#### 2.2使用ctrl+z快捷键

在命令执行过程中按ctrl+z键，后台将会在后台暂停。

### 3、后台命令管理

#### 3.1查看后台的工作

```
jobs [选项]
选项：
-l：显示工作的PID号
```

#### 3.2将后台暂停的工作恢复到前台执行

```
fg %工作号
```

> 注：%号可以省略，但是注意工作号和PID的区别

#### 3.3将后台暂停的工作恢复到后台执行

```
bg %工作号
```

