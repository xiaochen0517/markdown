## TCL语言

事务控制语言

#### 事务

- 一个或一组sql语句组成一个执行单元，这个执行单元要么全部执行，要么全部不执行。

#### 事务的ACID属性

- 原子性（Atomicity）
  - 原子性是指事务是一个不可分割的工作单位，事务中的操作要么都发生，要么什么都不发生
- 一致性（Consistency）
  - 事务必须使数据库从一个一致性状态变化到另一个一致性状态

- 隔离性（Isolation）
  - 事务的隔离性是指一个事务的执行不能被其他的事务干扰，即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰

- 持久性（Durability）
  - 持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来的其他操作和数据库故障不应该对其有任何影响

#### 事务的创建

- 隐式事务：事务没有明显的开启和结束的标记

- 显式事务：事务具有明显的开启和结束的标记

  - 前提：必须先设置自动提交功能为禁用

  - ```mysql
    #开启事务
    set autocommit=0;
    start transaction;#可选
    #增删改查
    commit;#提交事务
    rollback;#回滚
    
    savepoint 节点名;
    ```

#### 事务并发问题

- 脏读：t1读取t2更新但是还没有被提交的字段，若t2回滚，t1读取的值是无效的
- 不可重复读：t1读取字段后，t2更新了该字段，t1再次读取得到不同值
- 幻读：t1读取一个字段，t2在该表中插入了一些新的行之后，t1再次读取，会多出几行数据。

#### 事务的隔离级别

- read uncommitted：出现脏读、幻读、不可重复读
- read committed：避免脏读，出现幻读和不可重复读
- repeatable read：避免脏读和不可重复读，出现幻读
- serializable：都不会出现
- 查看隔离级别
  - select @@tx_isolation;
- 设置隔离级别
  - set session|global transaction isolation level 隔离级别

