# 微服务与微服务架构

## 1、什么是微服务

微服务 （ `Microservice Architecture` ）是近几年开始流行的一种架构思想。

通常而言，微服务架构是一种架构模式，或者说是一种架构风格，它提倡将单一的应用程序划分成一组小的服务每个服务运行在其独立的自己的进程内。服务之间互相协调，互相配置，为用户提供最终价值。服务之间采用轻量级的通信机制互相沟通，每个服务都围绕着具体的业务进行构建，并且能够被独立的部署到生产环境中，另外应尽量避免统一的，集中式的服务管理机制，对具体的一个服务而言，应根据业务上下文，选择合适的语言，工具对其进行构建，可以有一个非常轻量级的集中式管理来协调这些服务，可以使用不同的语言来编写服务，也可以使用不同的数据存储。

## 2、微服务与微服务架构

**微服务：** 

强调的是服务的大小，是具体解决某一个问题提供落地对应用服务的一个服务应用。

**微服务架构：** 

是一种新的架构形式，由 `Martin Fowler` 2014年提出

微服务架构是一种架构模式，它提倡将单一应用划分成一组小的服务，服务之间互相协调，互相配合，为用户提供最终价值。

## 3、微服务的优缺点

优点：

- 每个服务足够内聚，代码易理解
- 开发简单，开发效率高
- 能够被小团队开发
- 松耦合
- 可以使用不同的语言开发
- 易于和第三方集成
- 易于修改和维护
- 允许利用融合最新技术
- 只是业务逻辑，不会与 `HTML CSS` 或其他界面混合
- 每个微服务都有自己的储存内里，可以有自己的数据库，也可以有同一数据库

缺点：

- 开发人员要处理分布式系统的复杂性
- 多服务运维难度会随着服务的增加，运维的压力也在增大
- 系统部署依赖
- 服务间通信成本
- 数据一致性
- 系统集成测试
- 性能监控

## 4、微服务技术栈

| 微服务           | 技术                                         |
| ---------------- | -------------------------------------------- |
| 服务开发         | `Spring Boot/Spring/Spring MVC`              |
| 服务配置与管理   | `Netflix` 公司的 `Archaius` 阿里的 `Diamond` |
| 服务注册发现     | `Eureka/Consul/Zookeeper`                    |
| 服务调用         | `Rest/RPC/GRPC`                              |
| 服务熔断器       | `Hystrix/Envoy`                              |
| 负载均衡         | `Ribbon/Nginx`                               |
| 服务接口调用     | `Feign`                                      |
| 消息队列         | `Kafka/RabbitMQ/ActiveMQ`                    |
| 服务配置中心管理 | `SpringCloudConfig/Chef`                     |
| 服务路由         | `Zuul`                                       |
| 服务监控         | `Zabbix/Nagios/Metrics/Specatator`           |
| 全链路追踪       | `Zipkin/Brave/Dapper`                        |
| 服务部署         | `Docker/OpenStack/Kubernetes`                |
| 数据流操作开发包 | `SpringCloud Stream`                         |
| 事件消息总线     | `SpringCloud Bus`                            |

## 5、为什么使用 `Spring Cloud` 

### 5.1、选型依据

- 整体解决方案和框架成熟度
- 社区热度
- 可维护性
- 学习曲线

### 5.2、当前大公司微服务架构

- 阿里：`dubbo + HFS` 
- 京东：`JSF` 
- 新浪：`Motan` 
- 当当网：`DubboX` 

## 6、各微服务框架对比

| 功能、服务框架 | `Netflix/SpringCloud`                                 | `Motan`                                    | `GRPC`     | `Thrift`   | `Dubbo/DubboX` |
| -------------- | ----------------------------------------------------- | ------------------------------------------ | ---------- | ---------- | -------------- |
| 功能定位       | 完整服务框架爱                                        | `RPC` 框架，实现集群环境的基本服务注册发现 | `RPC` 框架 | `RPC` 框架 | 服务框架       |
| 支持 `Rest`    | √，`Ribbon` 支持多种可插拔的序列化选择                | ×                                          | ×          | ×          | ×              |
| 支持 `RPC`     | ×                                                     | √，`Hession2`                              | √          | √          | √              |
| 支持多语言     | √                                                     | ×                                          | √          | √          | ×              |
| 负载均衡       | √                                                     | √                                          | ×          | ×          | √              |
| 配置服务       | `Netfix Archaius,Spring Cloud Config Server` 集中配置 | √                                          | ×          | ×          | ×              |
| 服务调用链监控 | √                                                     | ×                                          | ×          | ×          | ×              |
| 高可用，容错   | √ | √ | × | × | √ |
| 典型应用案例   | `Netflix` | `Sina` | `Google` | `Facebook` |                |
| 社区活跃度 | 高 | 一般 | 高 | 一般 | 2017年后重新开始维护，之前中断5年 |
| 学习难度 | 中等 | 低 | 高 |高|低|
| 文档丰富程度 | 高 | 一般 | 一般 |一般|高|
| 其他 | `Spring Cloud Bus` 为应用程序带来了更多的管理端点 | 支持降级 | `Netflix` 内部在开发集成 `GRPC` |`IDL` 定义|实践的公司较多|
